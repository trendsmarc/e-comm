<div class="container">
    <div class="row">
        <div class="col-lg-8 my-2 py-4">
            <h1>{{header}}</h1>
            <div id="dataofDrew"></div>

            <div id="list-template">

                {{!-- Where the Items will be placed --}}

            </div>

            <div id="noItem">
                <h5>
                    Cart is empty, group yourself into 5.
                </h5>
            </div>
        </div>
        <div class="col-lg-4 my-2 py-4">
            <div class="card p-2">
                <h5>Shipping and Billing</h5>
                <label>ship to:</label>
                <p>Marc Asinas</p>
                <p>B2 L2 Mayon St. Country Homes Muntinlupa city</p>
                <form>
                    <div class="form-group">

                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div id="isalangSiya"></div>


<script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<script>

    var jsonObj = [];
    var deleteCookieChua = Cookies.get("ITEMS");

    if (deleteCookieChua == "") {
        Cookies.remove('ITEMS')
    }


    if (Cookies.get("ITEMS") == undefined) {
        jsonObj = [];

    } else {
        jsonObj = JSON.parse("[" + Cookies.get("ITEMS") + "]");

    }
    loadCartList(jsonObj);
    loadModal(jsonObj);

    for (let i in jsonObj) {

        $("#delBtn_" + jsonObj[i].item_code).click(function () {
            delete jsonObj.splice(i, 1);
            var tempData = JSON.stringify(jsonObj).toString().replace("[", "");
            Cookies.set("ITEMS", tempData.replace("]", ""));
            location.reload();
            setCookieInServer();
            jsonObj = JSON.parse("[" + Cookies.get("ITEMS") + "]");
            loadCartList(jsonObj);
        })

        $("#qnty_" + jsonObj[i].item_code).on('change', function () {
            $("#total_" + jsonObj[i].item_code).text(
                (parseFloat(jsonObj[i].item_qnty) * parseFloat(jsonObj[i].item_price)).toFixed(2));
            location.reload();
            jsonObj[i].item_qnty = $("#qnty_" + jsonObj[i].item_code).val();
            var tempData = JSON.stringify(jsonObj).toString().replace("[", "");
            Cookies.set("ITEMS", tempData.replace("]", ""));
            setCookieInServer();
            jsonObj = JSON.parse("[" + Cookies.get("ITEMS") + "]");
            loadCartList(jsonObj);
        });
    }

    if (jsonObj.length > 0) {
        $("#noItem").hide();
    }

    reloadCartNotif();

    setCookieInServer();


    function setCookieInServer() {
        var cookieData = "";
        if (Cookies.get("ITEMS") != undefined) {
            cookieData = Cookies.get("ITEMS");
        }
        $.ajax({
            type: "POST",
            dataType: "JSON",
            contentType: "application/json",
            data: JSON.stringify({ cookie: cookieData }),
            url: "/getCookie",
            success: function (result) {

            }, error: function (errVal) {


            }
        });
    }

    function reloadCartNotif() {
        $("#cartCount").text(Cookies.get("ITEMS").split("},{").length);
    }

    function loadCartList(jsonObj) {

        var listHtml = '<table class="table">' +
            '<thead>' +
            '<tr>' +
            '<th>ITEM</th>' +
            '<th>PRICE</th>' +
            '<th>QUANTITY</th>' +
            '<th>TOTAL</th>' +
            '<th>ACTIONS</th>' +
            '</tr>' +
            '</thead > ';

        for (let i in jsonObj) {
            var total = (parseFloat(jsonObj[i].item_qnty) * parseFloat(jsonObj[i].item_price)).toFixed(2);

            listHtml += '<tbody id="tbody_' + jsonObj[i].item_code + '">' +
                '<tr id="tr_' + jsonObj[i].item_code + '">' +
                '<td>' + jsonObj[i].item_name + '</td>' +
                '<td> ₱ <span id="price_"' + jsonObj[i].item_code + '>' + jsonObj[i].item_price + '</span></td>' +
                '<td> <input type="number" min="1" id="qnty_' + jsonObj[i].item_code + '" value="' + jsonObj[i].item_qnty + '"></td>' +
                '<td>₱ <span id="total_' + jsonObj[i].item_code + '">' + total + '</span></td>' +
                '<td><button class="btn btn-sm btn-danger"  data-toggle="modal" data-target="#delcartModal_' + jsonObj[i].item_code + '">DELETE</button></td>' +
                '</tr>' +
                '</tbody >';
        }

        listHtml += "</table>";
        $("#list-template").html(listHtml);


    }



    function loadModal(jsonObj) {

        var modalHTML = '';

        for (let i in jsonObj) {
            modalHTML += '<div id="delcartModal_' + jsonObj[i].item_code + '" class="modal fade" role="dialog">' +
                '<div class="modal-dialog"> ' +
                '<div class="modal-content">';

            modalHTML += '<div class="modal-header">' +
                '<h4 class="modal-title">Delete Item</h4>' +
                '</div>' +
                '<div class="modal-body">' +
                '<p>Are you sure you want to delete this ' + jsonObj[i].item_name + '</p > ' +
                '</div>' +
                '<div class="modal-footer">' +
                '<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>' +
                '<button type="button" class="btn btn-danger" id="delBtn_' + jsonObj[i].item_code + '">Delete</button>' +
                '</div>';

            modalHTML += '</div >' +
                '</div >' +
                '</div >';

        }

        $("#isalangSiya").html(modalHTML);
    }

</script>